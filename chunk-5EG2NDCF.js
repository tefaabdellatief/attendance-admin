import{a as F}from"./chunk-WMZDVTJT.js";import{a as z}from"./chunk-VJJD6Q4W.js";import{d as E,g as D,p as L,q as I,r as V}from"./chunk-OVLE5S5M.js";import{a as S}from"./chunk-VRPC7EEM.js";import"./chunk-X5YLR3NI.js";import{$ as o,B as b,C as h,Ca as A,G as f,M as p,N as n,O as i,Oa as k,P as x,S as C,T as c,U as d,Z as v,aa as g,da as T,ea as M,fa as w,n as m,o as _,wa as O,xa as P,z as u}from"./chunk-JMF3YSV7.js";import{i as y}from"./chunk-ODN5LVDJ.js";function N(a,r){a&1&&x(0,"app-spinner",17),a&2&&p("overlay",!1)}function j(a,r){if(a&1){let e=C();n(0,"div",18)(1,"span"),o(2,"\u26A0\uFE0F"),i(),n(3,"p"),o(4),i(),n(5,"app-button",19),c("btnClick",function(){m(e);let s=d();return _(s.loadTypes())}),o(6,"\u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629"),i()()}if(a&2){let e=d();u(4),g(e.error)}}function B(a,r){if(a&1){let e=C();n(0,"tr")(1,"td",27)(2,"span",28),o(3),i()(),n(4,"td",29)(5,"span",30),o(6),i()(),n(7,"td",31)(8,"div",32)(9,"app-button",33),c("btnClick",function(){let s=m(e).$implicit,l=d(3);return _(l.viewType(s))}),o(10," \u{1F441}\uFE0F \u0639\u0631\u0636 "),i(),n(11,"app-button",34),c("btnClick",function(){let s=m(e).$implicit,l=d(3);return _(l.editType(s))}),o(12," \u270F\uFE0F \u062A\u0639\u062F\u064A\u0644 "),i(),n(13,"app-button",35),c("btnClick",function(){let s=m(e).$implicit,l=d(3);return _(l.deleteType(s))}),o(14," \u{1F5D1}\uFE0F \u062D\u0630\u0641 "),i()()()()}if(a&2){let e=r.$implicit,t=d(3);u(3),g(e.name),u(3),g(e.description||"-"),u(3),p("disabled",t.saving),u(2),p("disabled",t.saving),u(2),p("disabled",t.saving)}}function $(a,r){if(a&1&&(n(0,"app-card",23)(1,"div",24)(2,"table",25)(3,"thead")(4,"tr")(5,"th"),o(6,"\u0627\u0644\u0627\u0633\u0645"),i(),n(7,"th"),o(8,"\u0627\u0644\u0648\u0635\u0641"),i(),n(9,"th"),o(10,"\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A"),i()()(),n(11,"tbody"),f(12,B,15,5,"tr",26),i()()()()),a&2){let e=d(2);p("title","\u0642\u0627\u0626\u0645\u0629 \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631")("subtitle","\u0625\u062C\u0645\u0627\u0644\u064A "+e.filteredTypes.length+" \u0646\u0648\u0639"),u(12),p("ngForOf",e.filteredTypes)}}function W(a,r){a&1&&(n(0,"p"),o(1,"\u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0623\u0646\u0648\u0627\u0639 \u062A\u0637\u0627\u0628\u0642 \u0627\u0644\u0628\u062D\u062B \u0627\u0644\u0645\u062D\u062F\u062F"),i())}function q(a,r){a&1&&(n(0,"p"),o(1,"\u0644\u0645 \u064A\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0623\u064A \u0623\u0646\u0648\u0627\u0639 \u062D\u0636\u0648\u0631 \u0628\u0639\u062F"),i())}function R(a,r){if(a&1){let e=C();n(0,"app-button",40),c("btnClick",function(){m(e);let s=d(3);return _(s.navigateToNew())}),o(1," \u0625\u0636\u0627\u0641\u0629 \u0623\u0648\u0644 \u0646\u0648\u0639 "),i()}}function G(a,r){if(a&1&&(n(0,"div",36)(1,"div",37),o(2,"\u{1F4CB}"),i(),n(3,"h3"),o(4,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0623\u0646\u0648\u0627\u0639 \u062D\u0636\u0648\u0631"),i(),f(5,W,2,0,"p",38)(6,q,2,0,"p",38)(7,R,2,0,"app-button",39),i()),a&2){let e=d(2);u(5),p("ngIf",e.searchQuery),u(),p("ngIf",!e.searchQuery),u(),p("ngIf",!e.searchQuery)}}function H(a,r){if(a&1&&(n(0,"div",20),f(1,$,13,3,"app-card",21)(2,G,8,3,"div",22),i()),a&2){let e=d();u(),p("ngIf",e.filteredTypes.length),u(),p("ngIf",!e.filteredTypes.length)}}function J(a,r){if(a&1&&(n(0,"div",41)(1,"div",42)(2,"h4"),o(3,"\u0645\u0639\u0644\u0648\u0645\u0627\u062A \u0627\u0644\u0646\u0648\u0639"),i(),n(4,"div",43)(5,"div",44)(6,"label"),o(7,"\u0627\u0644\u0627\u0633\u0645:"),i(),n(8,"span"),o(9),i()(),n(10,"div",44)(11,"label"),o(12,"\u0627\u0644\u0648\u0635\u0641:"),i(),n(13,"span"),o(14),i()()()()()),a&2){let e=d();u(9),g(e.selectedType.name),u(5),g(e.selectedType.description||"-")}}var Q=class a{constructor(r){this.sb=r}types=[];filteredTypes=[];loading=!1;saving=!1;error="";searchQuery="";viewModalVisible=!1;selectedType=null;ngOnInit(){return y(this,null,function*(){yield this.loadTypes()})}loadTypes(){return y(this,null,function*(){try{this.loading=!0,this.error="";let{data:r,error:e}=yield this.sb.rpc("attendance_types_get");if(e)throw e;this.types=r??[],this.filteredTypes=[...this.types]}catch(r){console.error("Error loading types:",r),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"}finally{this.loading=!1}})}filterTypes(){let r=[...this.types];if(this.searchQuery.trim()){let e=this.searchQuery.toLowerCase().trim();r=r.filter(t=>t.name?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))}this.filteredTypes=r}clearSearch(){this.searchQuery="",this.filteredTypes=[...this.types]}navigateToNew(){window.location.href="/attendance-types/new"}editType(r){r.id&&(window.location.href=`/attendance-types/edit/${r.id}`)}viewType(r){this.selectedType=r,this.viewModalVisible=!0}closeViewModal(){this.viewModalVisible=!1,this.selectedType=null}deleteType(r){return y(this,null,function*(){if(!(!r.id||!confirm(`\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 "${r.name}"\u061F`)))try{this.saving=!0;let{data:t,error:s}=yield this.sb.rpc("attendance_types_delete",{_id:r.id});if(s){let l=s.message||"";if((s.code||"")==="23503"||/foreign key/i.test(l)||/violat(es|ed) foreign key/i.test(l))this.error="\u062A\u0639\u0630\u0631 \u062D\u0630\u0641 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0644\u0648\u062C\u0648\u062F \u0633\u062C\u0644\u0627\u062A \u0645\u0631\u062A\u0628\u0637\u0629 \u0628\u0647. \u064A\u0631\u062C\u0649 \u0625\u0632\u0627\u0644\u0629 \u0627\u0644\u0627\u0631\u062A\u0628\u0627\u0637\u0627\u062A \u0623\u0648\u0644\u0627\u064B.";else throw s;return}t?(this.types=this.types.filter(l=>l.id!==r.id),this.filteredTypes=this.filteredTypes.filter(l=>l.id!==r.id)):this.error="\u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0627\u0644\u0645\u0631\u0627\u062F \u062D\u0630\u0641\u0647"}catch(t){console.error("Error deleting type:",t),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062D\u0630\u0641 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"}finally{this.saving=!1}})}static \u0275fac=function(e){return new(e||a)(b(S))};static \u0275cmp=h({type:a,selectors:[["app-attendance-types-list"]],decls:29,vars:11,consts:[[1,"page-header"],[1,"header-content"],[1,"page-subtitle"],["variant","primary",3,"btnClick","disabled"],[1,"search-bar"],[1,"search-section"],["placeholder","\u0627\u0644\u0628\u062D\u062B \u0641\u064A \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0627\u0644\u0648\u0635\u0641...",3,"ngModelChange","search","clear","ngModel"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631...",3,"overlay",4,"ngIf"],["class","error-message",4,"ngIf"],["class","types-list-container",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],["type","button",3,"click"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["variant","outline",3,"btnClick"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631...",3,"overlay"],[1,"error-message"],["variant","outline","size","sm",3,"btnClick"],[1,"types-list-container"],[3,"title","subtitle",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"title","subtitle"],[1,"table-container"],[1,"app-table"],[4,"ngFor","ngForOf"],[1,"type-name"],[1,"name-text"],[1,"type-description"],[1,"description-text"],[1,"actions"],[1,"action-buttons"],["variant","primary","size","sm",3,"btnClick","disabled"],["variant","outline","size","sm",3,"btnClick","disabled"],["variant","danger","size","sm",3,"btnClick","disabled"],[1,"empty-state"],[1,"empty-icon"],[4,"ngIf"],["variant","primary",3,"btnClick",4,"ngIf"],["variant","primary",3,"btnClick"],[1,"modal-body"],[1,"info-section"],[1,"info-grid"],[1,"info-item"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),o(3,"\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"),i(),n(4,"p",2),o(5,"\u0625\u062F\u0627\u0631\u0629 \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0648\u0627\u0644\u0627\u0646\u0635\u0631\u0627\u0641 \u0641\u064A \u0627\u0644\u0646\u0638\u0627\u0645"),i()(),n(6,"app-button",3),c("btnClick",function(){return t.navigateToNew()}),n(7,"span"),o(8,"\u2795"),i(),o(9," \u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u062C\u062F\u064A\u062F "),i()(),n(10,"div",4)(11,"div",5)(12,"app-enhanced-search",6),w("ngModelChange",function(l){return M(t.searchQuery,l)||(t.searchQuery=l),l}),c("search",function(){return t.filterTypes()})("clear",function(){return t.clearSearch()}),i()()(),f(13,N,1,1,"app-spinner",7)(14,j,7,1,"div",8)(15,H,3,2,"div",9),n(16,"div",10),c("click",function(){return t.closeViewModal()}),n(17,"div",11),c("click",function(l){return l.stopPropagation()}),n(18,"div",12)(19,"h3"),o(20,"\u0639\u0631\u0636 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"),i(),n(21,"button",13),c("click",function(){return t.closeViewModal()}),o(22,"\xD7"),i()(),f(23,J,15,2,"div",14),n(24,"div",15)(25,"app-button",16),c("btnClick",function(){return t.closeViewModal()}),o(26,"\u0625\u063A\u0644\u0627\u0642"),i(),n(27,"app-button",3),c("btnClick",function(){return t.editType(t.selectedType)}),o(28,"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0646\u0648\u0639"),i()()()()),e&2&&(u(6),p("disabled",t.loading),u(6),T("ngModel",t.searchQuery),u(),p("ngIf",t.loading),u(),p("ngIf",t.error&&!t.loading),u(),p("ngIf",!t.loading&&!t.error),u(),v("visible",t.viewModalVisible),u(),v("visible",t.viewModalVisible),u(6),p("ngIf",t.selectedType),u(4),p("disabled",!t.selectedType))},dependencies:[A,O,P,k,L,E,D,V,I,z,F],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--color-primary-dark);font-size:1.8rem}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--muted-text);font-size:1rem}.search-bar[_ngcontent-%COMP%]{margin-bottom:1.5rem}.search-section[_ngcontent-%COMP%]{position:relative;max-width:500px}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#c62828;flex:1}.types-list-container[_ngcontent-%COMP%]{margin-top:1rem}.type-name[_ngcontent-%COMP%]{min-width:150px}.name-text[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}.type-description[_ngcontent-%COMP%]{min-width:200px;max-width:400px}.description-text[_ngcontent-%COMP%]{color:var(--text-color);word-break:break-word}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:center}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem;color:var(--muted-text)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1.5rem}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:none;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .3s ease}.modal-overlay.visible[_ngcontent-%COMP%]{display:flex;opacity:1;pointer-events:auto}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:min(600px,95vw);max-height:90vh;overflow:hidden;box-shadow:0 20px 60px #0000004d;transform:scale(.9);transition:transform .3s ease}.modal.visible[_ngcontent-%COMP%]{transform:scale(1)}.modal-header[_ngcontent-%COMP%]{background:var(--color-primary-dark);color:#fff;padding:1.25rem 1.5rem;display:flex;align-items:center;justify-content:space-between}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600}.modal-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;font-size:1.5rem;cursor:pointer;padding:.25rem;border-radius:4px;transition:background .2s ease}.modal-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#ffffff1a}.modal-body[_ngcontent-%COMP%]{padding:1.5rem;max-height:60vh;overflow-y:auto}.modal-footer[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid var(--border-color);display:flex;gap:.75rem;justify-content:flex-end;background:#f8f9fa}.info-section[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border-color);border-radius:8px;padding:1rem}.info-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--color-primary-dark);font-size:1rem;font-weight:600;border-bottom:2px solid var(--color-primary);padding-bottom:.5rem}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color);font-size:.9rem}.info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--muted-text);font-size:.95rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.search-section[_ngcontent-%COMP%]{max-width:none}.action-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:.25rem}.type-description[_ngcontent-%COMP%]{max-width:200px}.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{Q as AttendanceTypesListComponent};
