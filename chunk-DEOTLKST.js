import{a as Q}from"./chunk-LC3RXJFZ.js";import{a as V}from"./chunk-WMZDVTJT.js";import{a as N}from"./chunk-VJJD6Q4W.js";import{d as D,g as I,p as A,q as F,r as z}from"./chunk-OVLE5S5M.js";import{a as L}from"./chunk-VRPC7EEM.js";import"./chunk-X5YLR3NI.js";import{$ as r,B as y,C as M,Ca as k,G as _,M as s,N as t,O as n,Oa as T,P as B,S as b,T as d,U as m,X as C,Z as v,aa as p,da as w,ea as E,fa as O,n as h,na as x,o as f,wa as P,xa as S,z as l}from"./chunk-JMF3YSV7.js";import{i as g}from"./chunk-ODN5LVDJ.js";function $(a,o){a&1&&B(0,"app-spinner",20),a&2&&s("overlay",!1)}function R(a,o){if(a&1){let e=b();t(0,"div",21)(1,"span"),r(2,"\u26A0\uFE0F"),n(),t(3,"p"),r(4),n(),t(5,"app-button",22),d("btnClick",function(){h(e);let u=m();return f(u.loadBranches())}),r(6,"\u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629"),n()()}if(a&2){let e=m();l(4),p(e.error)}}function W(a,o){if(a&1&&(t(0,"span",41),r(1),n()),a&2){let e=m().$implicit;l(),p(e.latitude)}}function q(a,o){a&1&&r(0,"-")}function G(a,o){if(a&1&&(t(0,"span",41),r(1),n()),a&2){let e=m().$implicit;l(),p(e.longitude)}}function H(a,o){a&1&&r(0,"-")}function J(a,o){if(a&1){let e=b();t(0,"tr")(1,"td",30)(2,"span",31),r(3),n()(),t(4,"td",32)(5,"span",33),r(6),n()(),t(7,"td",34),_(8,W,2,1,"span",35)(9,q,1,0,"ng-template",null,0,x),n(),t(11,"td",34),_(12,G,2,1,"span",35)(13,H,1,0,"ng-template",null,1,x),n(),t(15,"td",36)(16,"div",37)(17,"app-button",38),d("btnClick",function(){let u=h(e).$implicit,c=m(3);return f(c.viewBranch(u))}),r(18," \u{1F441}\uFE0F \u0639\u0631\u0636 "),n(),t(19,"app-button",39),d("btnClick",function(){let u=h(e).$implicit,c=m(3);return f(c.editBranch(u))}),r(20," \u270F\uFE0F \u062A\u0639\u062F\u064A\u0644 "),n(),t(21,"app-button",40),d("btnClick",function(){let u=h(e).$implicit,c=m(3);return f(c.deleteBranch(u))}),r(22," \u{1F5D1}\uFE0F \u062D\u0630\u0641 "),n()()()()}if(a&2){let e=o.$implicit,i=C(10),u=C(14),c=m(3);l(3),p(e.name),l(3),p(e.address||"-"),l(2),s("ngIf",e.latitude)("ngIfElse",i),l(4),s("ngIf",e.longitude)("ngIfElse",u),l(5),s("disabled",c.saving),l(2),s("disabled",c.saving),l(2),s("disabled",c.saving)}}function K(a,o){if(a&1&&(t(0,"app-card",26)(1,"div",27)(2,"table",28)(3,"thead")(4,"tr")(5,"th"),r(6,"\u0627\u0644\u0627\u0633\u0645"),n(),t(7,"th"),r(8,"\u0627\u0644\u0639\u0646\u0648\u0627\u0646"),n(),t(9,"th"),r(10,"\u062E\u0637 \u0627\u0644\u0639\u0631\u0636"),n(),t(11,"th"),r(12,"\u062E\u0637 \u0627\u0644\u0637\u0648\u0644"),n(),t(13,"th"),r(14,"\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A"),n()()(),t(15,"tbody"),_(16,J,23,9,"tr",29),n()()()()),a&2){let e=m(2);s("title","\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0641\u0631\u0648\u0639")("subtitle","\u0625\u062C\u0645\u0627\u0644\u064A "+e.filteredBranches.length+" \u0641\u0631\u0639"),l(16),s("ngForOf",e.filteredBranches)}}function U(a,o){a&1&&(t(0,"p"),r(1,"\u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0641\u0631\u0648\u0639 \u062A\u0637\u0627\u0628\u0642 \u0627\u0644\u0628\u062D\u062B \u0627\u0644\u0645\u062D\u062F\u062F"),n())}function X(a,o){a&1&&(t(0,"p"),r(1,"\u0644\u0645 \u064A\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0623\u064A \u0641\u0631\u0648\u0639 \u0628\u0639\u062F"),n())}function Y(a,o){if(a&1){let e=b();t(0,"app-button",46),d("btnClick",function(){h(e);let u=m(3);return f(u.navigateToNew())}),r(1," \u0625\u0636\u0627\u0641\u0629 \u0623\u0648\u0644 \u0641\u0631\u0639 "),n()}}function Z(a,o){if(a&1&&(t(0,"div",42)(1,"div",43),r(2,"\u{1F3E2}"),n(),t(3,"h3"),r(4,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0641\u0631\u0648\u0639"),n(),_(5,U,2,0,"p",44)(6,X,2,0,"p",44)(7,Y,2,0,"app-button",45),n()),a&2){let e=m(2);l(5),s("ngIf",e.searchQuery),l(),s("ngIf",!e.searchQuery),l(),s("ngIf",!e.searchQuery)}}function ee(a,o){if(a&1&&(t(0,"div",23),_(1,K,17,3,"app-card",24)(2,Z,8,3,"div",25),n()),a&2){let e=m();l(),s("ngIf",e.filteredBranches.length),l(),s("ngIf",!e.filteredBranches.length)}}function te(a,o){if(a&1&&(t(0,"div",47)(1,"div",48)(2,"h4"),r(3,"\u0645\u0639\u0644\u0648\u0645\u0627\u062A \u0627\u0644\u0641\u0631\u0639"),n(),t(4,"div",49)(5,"div",50)(6,"label"),r(7,"\u0627\u0644\u0627\u0633\u0645:"),n(),t(8,"span"),r(9),n()(),t(10,"div",50)(11,"label"),r(12,"\u0627\u0644\u0639\u0646\u0648\u0627\u0646:"),n(),t(13,"span"),r(14),n()(),t(15,"div",50)(16,"label"),r(17,"\u062E\u0637 \u0627\u0644\u0639\u0631\u0636:"),n(),t(18,"span"),r(19),n()(),t(20,"div",50)(21,"label"),r(22,"\u062E\u0637 \u0627\u0644\u0637\u0648\u0644:"),n(),t(23,"span"),r(24),n()()()()()),a&2){let e=m();l(9),p(e.selectedBranch.name),l(5),p(e.selectedBranch.address||"-"),l(5),p(e.selectedBranch.latitude??"-"),l(5),p(e.selectedBranch.longitude??"-")}}var j=class a{constructor(o){this.sb=o}branches=[];filteredBranches=[];loading=!1;saving=!1;error="";searchQuery="";deleteModalVisible=!1;branchToDelete=null;viewModalVisible=!1;selectedBranch=null;ngOnInit(){return g(this,null,function*(){yield this.loadBranches()})}loadBranches(){return g(this,null,function*(){try{this.loading=!0,this.error="";let{data:o,error:e}=yield this.sb.rpc("branches_get");if(e)throw e;this.branches=o??[],this.filteredBranches=[...this.branches]}catch(o){console.error("Error loading branches:",o),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0641\u0631\u0648\u0639"}finally{this.loading=!1}})}filterBranches(){let o=[...this.branches];if(this.searchQuery.trim()){let e=this.searchQuery.toLowerCase().trim();o=o.filter(i=>i.name?.toLowerCase().includes(e)||i.address?.toLowerCase().includes(e))}this.filteredBranches=o}clearSearch(){this.searchQuery="",this.filteredBranches=[...this.branches]}navigateToNew(){window.location.href="/branches/new"}editBranch(o){o.id&&(window.location.href=`/branches/edit/${o.id}`)}viewBranch(o){this.selectedBranch=o,this.viewModalVisible=!0}closeViewModal(){this.viewModalVisible=!1,this.selectedBranch=null}deleteBranch(o){o.id&&(this.branchToDelete=o,this.deleteModalVisible=!0)}confirmDelete(){return g(this,null,function*(){if(this.branchToDelete?.id)try{this.saving=!0;let{data:o,error:e}=yield this.sb.rpc("branches_delete",{_id:this.branchToDelete.id});if(e){let i=e.message||"";if((e.code||"")==="23503"||/foreign key/i.test(i)||/violat(es|ed) foreign key/i.test(i))this.error="\u062A\u0639\u0630\u0631 \u062D\u0630\u0641 \u0627\u0644\u0641\u0631\u0639 \u0644\u0648\u062C\u0648\u062F \u0633\u062C\u0644\u0627\u062A \u0645\u0631\u062A\u0628\u0637\u0629 \u0628\u0647 (\u0645\u062B\u0644 \u0633\u062C\u0644\u0627\u062A \u0627\u0644\u062D\u0636\u0648\u0631 \u0623\u0648 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646). \u064A\u0631\u062C\u0649 \u0625\u0632\u0627\u0644\u0629 \u0627\u0644\u0627\u0631\u062A\u0628\u0627\u0637\u0627\u062A \u0623\u0648\u0644\u0627\u064B.";else throw e;return}o?(this.branches=this.branches.filter(i=>i.id!==this.branchToDelete.id),this.filteredBranches=this.filteredBranches.filter(i=>i.id!==this.branchToDelete.id),this.cancelDelete()):this.error="\u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0627\u0644\u0641\u0631\u0639 \u0627\u0644\u0645\u0631\u0627\u062F \u062D\u0630\u0641\u0647"}catch(o){console.error("Error deleting branch:",o),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062D\u0630\u0641 \u0627\u0644\u0641\u0631\u0639"}finally{this.saving=!1}})}cancelDelete(){this.deleteModalVisible=!1,this.branchToDelete=null}static \u0275fac=function(e){return new(e||a)(y(L))};static \u0275cmp=M({type:a,selectors:[["app-branches-list"]],decls:30,vars:16,consts:[["noLat",""],["noLng",""],[1,"page-header"],[1,"header-content"],[1,"page-subtitle"],["variant","primary",3,"btnClick","disabled"],[1,"search-bar"],[1,"search-section"],["placeholder","\u0627\u0644\u0628\u062D\u062B \u0641\u064A \u0627\u0644\u0641\u0631\u0648\u0639 \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0627\u0644\u0639\u0646\u0648\u0627\u0646...",3,"ngModelChange","search","clear","ngModel"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0641\u0631\u0648\u0639...",3,"overlay",4,"ngIf"],["class","error-message",4,"ngIf"],["class","branches-list-container",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],["type","button",3,"click"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],["variant","outline",3,"btnClick"],[3,"confirm","cancel","visible","title","message","itemName","loading"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0641\u0631\u0648\u0639...",3,"overlay"],[1,"error-message"],["variant","outline","size","sm",3,"btnClick"],[1,"branches-list-container"],[3,"title","subtitle",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"title","subtitle"],[1,"table-container"],[1,"app-table"],[4,"ngFor","ngForOf"],[1,"branch-name"],[1,"name-text"],[1,"branch-address"],[1,"address-text"],[1,"coordinates"],["class","coordinate-badge",4,"ngIf","ngIfElse"],[1,"actions"],[1,"action-buttons"],["variant","primary","size","sm",3,"btnClick","disabled"],["variant","outline","size","sm",3,"btnClick","disabled"],["variant","danger","size","sm",3,"btnClick","disabled"],[1,"coordinate-badge"],[1,"empty-state"],[1,"empty-icon"],[4,"ngIf"],["variant","primary",3,"btnClick",4,"ngIf"],["variant","primary",3,"btnClick"],[1,"modal-body"],[1,"info-section"],[1,"info-grid"],[1,"info-item"]],template:function(e,i){e&1&&(t(0,"div",2)(1,"div",3)(2,"h1"),r(3,"\u0627\u0644\u0641\u0631\u0648\u0639"),n(),t(4,"p",4),r(5,"\u0625\u062F\u0627\u0631\u0629 \u0641\u0631\u0648\u0639 \u0627\u0644\u0639\u0645\u0644 \u0641\u064A \u0627\u0644\u0646\u0638\u0627\u0645"),n()(),t(6,"app-button",5),d("btnClick",function(){return i.navigateToNew()}),t(7,"span"),r(8,"\u2795"),n(),r(9," \u0625\u0636\u0627\u0641\u0629 \u0641\u0631\u0639 \u062C\u062F\u064A\u062F "),n()(),t(10,"div",6)(11,"div",7)(12,"app-enhanced-search",8),O("ngModelChange",function(c){return E(i.searchQuery,c)||(i.searchQuery=c),c}),d("search",function(){return i.filterBranches()})("clear",function(){return i.clearSearch()}),n()()(),_(13,$,1,1,"app-spinner",9)(14,R,7,1,"div",10)(15,ee,3,2,"div",11),t(16,"div",12),d("click",function(){return i.closeViewModal()}),t(17,"div",13),d("click",function(c){return c.stopPropagation()}),t(18,"div",14)(19,"h3"),r(20,"\u0639\u0631\u0636 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639"),n(),t(21,"button",15),d("click",function(){return i.closeViewModal()}),r(22,"\xD7"),n()(),_(23,te,25,4,"div",16),t(24,"div",17)(25,"app-button",18),d("btnClick",function(){return i.closeViewModal()}),r(26,"\u0625\u063A\u0644\u0627\u0642"),n(),t(27,"app-button",5),d("btnClick",function(){return i.editBranch(i.selectedBranch)}),r(28,"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0641\u0631\u0639"),n()()()(),t(29,"app-delete-confirmation",19),d("confirm",function(){return i.confirmDelete()})("cancel",function(){return i.cancelDelete()}),n()),e&2&&(l(6),s("disabled",i.loading),l(6),w("ngModel",i.searchQuery),l(),s("ngIf",i.loading),l(),s("ngIf",i.error&&!i.loading),l(),s("ngIf",!i.loading&&!i.error),l(),v("visible",i.viewModalVisible),l(),v("visible",i.viewModalVisible),l(6),s("ngIf",i.selectedBranch),l(4),s("disabled",!i.selectedBranch),l(2),s("visible",i.deleteModalVisible)("title","\u062D\u0630\u0641 \u0627\u0644\u0641\u0631\u0639")("message","\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u0623\u0646\u0643 \u062A\u0631\u064A\u062F \u062D\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u0641\u0631\u0639\u061F")("itemName",i.branchToDelete==null?null:i.branchToDelete.name)("loading",i.saving))},dependencies:[k,P,S,T,A,D,I,z,F,N,Q,V],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--color-primary-dark);font-size:1.8rem}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--muted-text);font-size:1rem}.search-bar[_ngcontent-%COMP%]{margin-bottom:1.5rem}.search-section[_ngcontent-%COMP%]{position:relative;max-width:500px}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#c62828;flex:1}.branches-list-container[_ngcontent-%COMP%]{margin-top:1rem}.branch-name[_ngcontent-%COMP%]{min-width:150px}.name-text[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}.branch-address[_ngcontent-%COMP%]{min-width:200px;max-width:300px}.address-text[_ngcontent-%COMP%]{color:var(--text-color);word-break:break-word}.coordinates[_ngcontent-%COMP%]{width:120px}.coordinate-badge[_ngcontent-%COMP%]{display:inline-block;background:#f8f9fa;color:var(--text-color);padding:.25rem .5rem;border-radius:4px;font-size:.8rem;font-weight:500;font-family:monospace;border:1px solid var(--border-color)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:center}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem;color:var(--muted-text)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1.5rem}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:none;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .3s ease}.modal-overlay.visible[_ngcontent-%COMP%]{display:flex;opacity:1;pointer-events:auto}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:min(700px,95vw);max-height:90vh;overflow:hidden;box-shadow:0 20px 60px #0000004d;transform:scale(.9);transition:transform .3s ease}.modal.visible[_ngcontent-%COMP%]{transform:scale(1)}.modal-header[_ngcontent-%COMP%]{background:var(--color-primary-dark);color:#fff;padding:1.25rem 1.5rem;display:flex;align-items:center;justify-content:space-between}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600}.modal-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;font-size:1.5rem;cursor:pointer;padding:.25rem;border-radius:4px;transition:background .2s ease}.modal-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#ffffff1a}.modal-body[_ngcontent-%COMP%]{padding:1.5rem;max-height:60vh;overflow-y:auto}.modal-footer[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid var(--border-color);display:flex;gap:.75rem;justify-content:flex-end;background:#f8f9fa}.info-section[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border-color);border-radius:8px;padding:1rem}.info-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--color-primary-dark);font-size:1rem;font-weight:600;border-bottom:2px solid var(--color-primary);padding-bottom:.5rem}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color);font-size:.9rem}.info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--muted-text);font-size:.95rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.search-section[_ngcontent-%COMP%]{max-width:none}.action-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:.25rem}.branch-address[_ngcontent-%COMP%]{max-width:150px}.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{j as BranchesListComponent};
