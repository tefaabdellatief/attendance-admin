import{a as H}from"./chunk-VJJD6Q4W.js";import{c as T,d as D,e as N,f as W,g as z,h as R,i as j,o as L,p as q,q as U,r as G}from"./chunk-OVLE5S5M.js";import{a as V}from"./chunk-VRPC7EEM.js";import"./chunk-X5YLR3NI.js";import{$ as o,B as x,C as w,Ca as O,G as g,Ia as I,Ka as B,M as d,N as r,O as i,Oa as k,P as A,S as M,T as f,U as m,X as S,Z as C,aa as h,ba as F,da as b,ea as _,fa as v,n as c,o as p,x as E,xa as P,z as u}from"./chunk-JMF3YSV7.js";import{i as y}from"./chunk-ODN5LVDJ.js";function K(a,t){a&1&&A(0,"app-spinner",8),a&2&&d("overlay",!1)}function Q(a,t){if(a&1){let e=M();r(0,"div",9)(1,"span"),o(2,"\u26A0\uFE0F"),i(),r(3,"p"),o(4),i(),r(5,"app-button",10),f("btnClick",function(){c(e);let l=m();return p(l.loadBranch())}),o(6,"\u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629"),i()()}if(a&2){let e=m();u(4),h(e.error)}}function X(a,t){a&1&&(r(0,"div",33),o(1," \u0627\u0633\u0645 \u0627\u0644\u0641\u0631\u0639 \u0645\u0637\u0644\u0648\u0628 "),i())}function Y(a,t){a&1&&(r(0,"div",33),o(1," \u062E\u0637 \u0627\u0644\u0639\u0631\u0636 \u063A\u064A\u0631 \u0635\u062D\u064A\u062D "),i())}function Z(a,t){a&1&&(r(0,"div",33),o(1," \u062E\u0637 \u0627\u0644\u0637\u0648\u0644 \u063A\u064A\u0631 \u0635\u062D\u064A\u062D "),i())}function $(a,t){if(a&1&&(r(0,"div",13)(1,"h4"),o(2,"\u0645\u0639\u0627\u064A\u0646\u0629 \u0627\u0644\u0645\u0648\u0642\u0639"),i(),r(3,"div",34)(4,"div",35)(5,"label"),o(6,"\u062E\u0637 \u0627\u0644\u0639\u0631\u0636:"),i(),r(7,"span",36),o(8),i()(),r(9,"div",35)(10,"label"),o(11,"\u062E\u0637 \u0627\u0644\u0637\u0648\u0644:"),i(),r(12,"span",36),o(13),i()(),r(14,"div",35)(15,"label"),o(16,"\u0631\u0627\u0628\u0637 \u0627\u0644\u062E\u0631\u064A\u0637\u0629:"),i(),r(17,"a",37),o(18," \u0639\u0631\u0636 \u0639\u0644\u0649 \u0627\u0644\u062E\u0631\u064A\u0637\u0629 "),i()()()()),a&2){let e=m(2);u(8),h(e.branch.latitude),u(5),h(e.branch.longitude),u(4),d("href",e.getMapUrl(),E)}}function ee(a,t){if(a&1&&(r(0,"div",38)(1,"span"),o(2,"\u26A0\uFE0F"),i(),r(3,"p"),o(4),i()()),a&2){let e=m(2);u(4),h(e.formError)}}function te(a,t){if(a&1){let e=M();r(0,"div")(1,"app-card",11)(2,"form",12,0),f("ngSubmit",function(){c(e);let l=m();return p(l.onSubmit())}),r(4,"div",13)(5,"h4"),o(6,"\u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062A \u0627\u0644\u0623\u0633\u0627\u0633\u064A\u0629"),i(),r(7,"div",14)(8,"div",15)(9,"label",16),o(10,"\u0627\u0633\u0645 \u0627\u0644\u0641\u0631\u0639 "),r(11,"span",17),o(12,"*"),i()(),r(13,"input",18),v("ngModelChange",function(l){c(e);let s=m();return _(s.branch.name,l)||(s.branch.name=l),p(l)}),i(),g(14,X,2,0,"div",19),i(),r(15,"div",20)(16,"label",21),o(17,"\u0627\u0644\u0639\u0646\u0648\u0627\u0646"),i(),r(18,"textarea",22),v("ngModelChange",function(l){c(e);let s=m();return _(s.branch.address,l)||(s.branch.address=l),p(l)}),o(19,"                "),i(),r(20,"small",23),o(21,"\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0643\u0627\u0645\u0644 \u0644\u0644\u0641\u0631\u0639"),i()()()(),r(22,"div",13)(23,"h4"),o(24,"\u0627\u0644\u0645\u0648\u0642\u0639 \u0627\u0644\u062C\u063A\u0631\u0627\u0641\u064A"),i(),r(25,"div",14)(26,"div",15)(27,"label",24),o(28,"\u062E\u0637 \u0627\u0644\u0639\u0631\u0636"),i(),r(29,"input",25),v("ngModelChange",function(l){c(e);let s=m();return _(s.branch.latitude,l)||(s.branch.latitude=l),p(l)}),i(),g(30,Y,2,0,"div",19),r(31,"small",23),o(32,"\u062E\u0637 \u0627\u0644\u0639\u0631\u0636 (Latitude) - \u0645\u062B\u0627\u0644: 31.2001"),i()(),r(33,"div",15)(34,"label",26),o(35,"\u062E\u0637 \u0627\u0644\u0637\u0648\u0644"),i(),r(36,"input",27),v("ngModelChange",function(l){c(e);let s=m();return _(s.branch.longitude,l)||(s.branch.longitude=l),p(l)}),i(),g(37,Z,2,0,"div",19),r(38,"small",23),o(39,"\u062E\u0637 \u0627\u0644\u0637\u0648\u0644 (Longitude) - \u0645\u062B\u0627\u0644: 29.9187"),i()()()(),g(40,$,19,3,"div",28),r(41,"div",29)(42,"app-button",30),o(43),i(),r(44,"app-button",31),f("btnClick",function(){c(e);let l=m();return p(l.goBack())}),o(45," \u0625\u0644\u063A\u0627\u0621 "),i()(),g(46,ee,5,1,"div",32),i()()()}if(a&2){let e=S(3),n=m();u(),d("title","\u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639")("subtitle",n.branchId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639":"\u0625\u062F\u062E\u0627\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639 \u0627\u0644\u062C\u062F\u064A\u062F"),u(12),C("is-invalid",n.submitted&&e.controls.name.errors),b("ngModel",n.branch.name),u(),d("ngIf",n.submitted&&(e.controls.name==null?null:e.controls.name.errors)),u(4),b("ngModel",n.branch.address),u(11),C("is-invalid",n.submitted&&e.controls.latitude.errors),b("ngModel",n.branch.latitude),u(),d("ngIf",n.submitted&&(e.controls.latitude==null?null:e.controls.latitude.errors)),u(6),C("is-invalid",n.submitted&&e.controls.longitude.errors),b("ngModel",n.branch.longitude),u(),d("ngIf",n.submitted&&(e.controls.longitude==null?null:e.controls.longitude.errors)),u(3),d("ngIf",n.branch.latitude&&n.branch.longitude),u(2),d("loading",n.saving)("disabled",!e.form.valid||n.saving),u(),F(" ",n.branchId?"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A":"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0631\u0639"," "),u(),d("disabled",n.saving),u(2),d("ngIf",n.formError)}}var J=class a{constructor(t,e,n){this.route=t;this.router=e;this.sb=n}branch={name:"",address:"",latitude:null,longitude:null};branchId=null;loading=!1;saving=!1;submitted=!1;error="";formError="";ngOnInit(){this.branchId=this.route.snapshot.paramMap.get("id"),this.branchId&&this.loadBranch()}loadBranch(){return y(this,null,function*(){if(this.branchId)try{this.loading=!0,this.error="";let{data:t,error:e}=yield this.sb.rpc("branches_get_by_id",{_id:this.branchId});if(e)throw e;this.branch={name:t.name||"",address:t.address||"",latitude:t.latitude??null,longitude:t.longitude??null}}catch(t){console.error("Error loading branch:",t),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639"}finally{this.loading=!1}})}onSubmit(){return y(this,null,function*(){if(this.submitted=!0,this.formError="",!this.branch.name){this.formError="\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0641\u0631\u0639";return}if(this.branch.latitude!==null&&this.branch.latitude!==""){let t=parseFloat(this.branch.latitude);if(isNaN(t)||t<-90||t>90){this.formError="\u062E\u0637 \u0627\u0644\u0639\u0631\u0636 \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0631\u0642\u0645\u064B\u0627 \u0628\u064A\u0646 -90 \u0648 90";return}}if(this.branch.longitude!==null&&this.branch.longitude!==""){let t=parseFloat(this.branch.longitude);if(isNaN(t)||t<-180||t>180){this.formError="\u062E\u0637 \u0627\u0644\u0637\u0648\u0644 \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0631\u0642\u0645\u064B\u0627 \u0628\u064A\u0646 -180 \u0648 180";return}}try{this.saving=!0;let t={name:this.branch.name.trim(),address:this.branch.address?.trim()||null,latitude:this.branch.latitude!==null&&this.branch.latitude!==""?parseFloat(this.branch.latitude):null,longitude:this.branch.longitude!==null&&this.branch.longitude!==""?parseFloat(this.branch.longitude):null};if(this.branchId){let{error:e}=yield this.sb.rpc("branches_update",{_id:this.branchId,_name:t.name,_address:t.address,_latitude:t.latitude,_longitude:t.longitude});if(e)throw e}else{let{error:e}=yield this.sb.rpc("branches_insert",{_name:t.name,_address:t.address,_latitude:t.latitude,_longitude:t.longitude});if(e)throw e}this.router.navigate(["/branches"])}catch(t){console.error("Error saving branch:",t),this.formError=this.branchId?"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0641\u0631\u0639":"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0631\u0639"}finally{this.saving=!1}})}goBack(){this.router.navigate(["/branches"])}getMapUrl(){return this.branch.latitude&&this.branch.longitude?`https://www.google.com/maps?q=${this.branch.latitude},${this.branch.longitude}`:"#"}static \u0275fac=function(e){return new(e||a)(x(I),x(B),x(V))};static \u0275cmp=w({type:a,selectors:[["app-branches-form"]],decls:11,vars:6,consts:[["branchForm","ngForm"],[1,"page-header"],[1,"header-content"],[1,"page-subtitle"],["variant","outline",3,"btnClick","disabled"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639...",3,"overlay",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639...",3,"overlay"],[1,"error-message"],["variant","outline","size","sm",3,"btnClick"],[3,"title","subtitle"],[1,"branch-form",3,"ngSubmit"],[1,"form-section"],[1,"form-grid"],[1,"form-group"],["for","name"],[1,"required"],["type","text","id","name","name","name","required","","placeholder","\u0623\u062F\u062E\u0644 \u0627\u0633\u0645 \u0627\u0644\u0641\u0631\u0639",1,"form-control",3,"ngModelChange","ngModel"],["class","invalid-feedback",4,"ngIf"],[1,"form-group","full-width"],["for","address"],["id","address","name","address","rows","3","placeholder","\u0623\u062F\u062E\u0644 \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-hint"],["for","latitude"],["type","number","id","latitude","name","latitude","step","any","placeholder","31.2001",1,"form-control",3,"ngModelChange","ngModel"],["for","longitude"],["type","number","id","longitude","name","longitude","step","any","placeholder","29.9187",1,"form-control",3,"ngModelChange","ngModel"],["class","form-section",4,"ngIf"],[1,"form-actions"],["type","submit","variant","primary",3,"loading","disabled"],["type","button","variant","outline",3,"btnClick","disabled"],["class","form-error",4,"ngIf"],[1,"invalid-feedback"],[1,"preview-container"],[1,"preview-item"],[1,"coordinate-badge"],["target","_blank",1,"map-link",3,"href"],[1,"form-error"]],template:function(e,n){e&1&&(r(0,"div",1)(1,"div",2)(2,"h1"),o(3),i(),r(4,"p",3),o(5),i()(),r(6,"app-button",4),f("btnClick",function(){return n.goBack()}),o(7," \u2190 \u0631\u062C\u0648\u0639 \u0644\u0644\u0642\u0627\u0626\u0645\u0629 "),i()(),g(8,K,1,1,"app-spinner",5)(9,Q,7,1,"div",6)(10,te,47,21,"div",7)),e&2&&(u(3),h(n.branchId?"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0641\u0631\u0639":"\u0625\u0636\u0627\u0641\u0629 \u0641\u0631\u0639 \u062C\u062F\u064A\u062F"),u(2),h(n.branchId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0641\u0631\u0639 \u0627\u0644\u0645\u062D\u062F\u062F":"\u0625\u0636\u0627\u0641\u0629 \u0641\u0631\u0639 \u0639\u0645\u0644 \u062C\u062F\u064A\u062F \u0644\u0644\u0646\u0638\u0627\u0645"),u(),d("disabled",n.saving),u(2),d("ngIf",n.loading),u(),d("ngIf",n.error&&!n.loading),u(),d("ngIf",!n.loading&&!n.error))},dependencies:[O,P,q,R,T,j,D,N,L,z,W,k,G,U,H],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--color-primary-dark);font-size:1.8rem}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--muted-text);font-size:1rem}.branch-form[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.form-section[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:8px;padding:1.5rem;background:#fafafa;margin-bottom:2rem}.form-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--color-primary-dark);font-size:1.1rem;border-bottom:1px solid var(--border-color);padding-bottom:.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group.full-width[_ngcontent-%COMP%]{grid-column:1/-1}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-color)}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:6px;font-size:1rem;line-height:1.5;background:#fff;transition:all .2s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px #f6b81933}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 2px #dc354533}.invalid-feedback[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#dc3545}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.8rem;color:var(--muted-text)}.preview-container[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border-color);border-radius:8px;padding:1rem}.preview-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.5rem 0;border-bottom:1px dashed var(--border-color)}.preview-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.preview-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:0;font-weight:600;color:var(--text-color)}.coordinate-badge[_ngcontent-%COMP%]{display:inline-block;background:#f8f9fa;color:var(--text-color);padding:.25rem .5rem;border-radius:4px;font-size:.9rem;font-weight:500;font-family:monospace;border:1px solid var(--border-color)}.map-link[_ngcontent-%COMP%]{color:var(--color-primary);text-decoration:none;font-weight:500}.map-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:1rem;border-top:1px solid var(--border-color)}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#c62828;flex:1}.form-error[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:6px;padding:1rem;display:flex;align-items:center;gap:.5rem;color:#c62828;margin-top:1rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.form-section[_ngcontent-%COMP%]{padding:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.preview-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}"]})};export{J as BranchesFormComponent};
