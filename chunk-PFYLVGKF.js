import{a as X}from"./chunk-VJJD6Q4W.js";import{c as z,d as B,e as H,f as R,g as j,h as q,i as L,n as G,o as J,p as K,q as Q,r as U}from"./chunk-OVLE5S5M.js";import{a as D}from"./chunk-VRPC7EEM.js";import"./chunk-X5YLR3NI.js";import{$ as o,B as x,C as k,Ca as T,G as f,Ia as V,Ka as N,M as l,N as i,O as n,Oa as W,P as I,S as M,T as b,U as d,X as P,Z as C,aa as _,ba as F,da as g,ea as h,fa as v,n as c,o as p,xa as O,z as a}from"./chunk-JMF3YSV7.js";import{i as A}from"./chunk-ODN5LVDJ.js";function it(s,r){s&1&&I(0,"app-spinner",8),s&2&&l("overlay",!1)}function nt(s,r){if(s&1){let t=M();i(0,"div",9)(1,"span"),o(2,"\u26A0\uFE0F"),n(),i(3,"p"),o(4),n(),i(5,"app-button",10),b("btnClick",function(){c(t);let u=d();return p(u.loadShift())}),o(6,"\u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629"),n()()}if(s&2){let t=d();a(4),_(t.error)}}function rt(s,r){s&1&&(i(0,"div",34),o(1," \u0627\u0633\u0645 \u0627\u0644\u0648\u0631\u062F\u064A\u0629 \u0645\u0637\u0644\u0648\u0628 "),n())}function ut(s,r){s&1&&(i(0,"div",34),o(1," \u0648\u0642\u062A \u0627\u0644\u0628\u062F\u0627\u064A\u0629 \u0645\u0637\u0644\u0648\u0628 "),n())}function ot(s,r){s&1&&(i(0,"div",34),o(1," \u0639\u062F\u062F \u0627\u0644\u0633\u0627\u0639\u0627\u062A \u0645\u0637\u0644\u0648\u0628 \u0648\u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0623\u0643\u0628\u0631 \u0645\u0646 0 "),n())}function at(s,r){if(s&1&&(i(0,"div",13)(1,"h4"),o(2,"\u0645\u0639\u0627\u064A\u0646\u0629 \u0627\u0644\u0648\u0631\u062F\u064A\u0629"),n(),i(3,"div",35)(4,"div",36)(5,"label"),o(6,"\u0648\u0642\u062A \u0627\u0644\u0628\u062F\u0627\u064A\u0629:"),n(),i(7,"span",37),o(8),n()(),i(9,"div",36)(10,"label"),o(11,"\u0648\u0642\u062A \u0627\u0644\u0646\u0647\u0627\u064A\u0629:"),n(),i(12,"span",37),o(13),n()(),i(14,"div",36)(15,"label"),o(16,"\u0645\u062F\u0629 \u0627\u0644\u0639\u0645\u0644:"),n(),i(17,"span",38),o(18),n()()()()),s&2){let t=d(2);a(8),_(t.shift.start_time),a(5),_(t.computeEndTime(t.shift.start_time,t.shift.duration_hours)),a(5),F("",t.shift.duration_hours," \u0633\u0627\u0639\u0629")}}function st(s,r){if(s&1&&(i(0,"div",39)(1,"span"),o(2,"\u26A0\uFE0F"),n(),i(3,"p"),o(4),n()()),s&2){let t=d(2);a(4),_(t.formError)}}function mt(s,r){if(s&1){let t=M();i(0,"div")(1,"app-card",11)(2,"form",12,0),b("ngSubmit",function(){c(t);let u=d();return p(u.onSubmit())}),i(4,"div",13)(5,"h4"),o(6,"\u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062A \u0627\u0644\u0623\u0633\u0627\u0633\u064A\u0629"),n(),i(7,"div",14)(8,"div",15)(9,"label",16),o(10,"\u0627\u0633\u0645 \u0627\u0644\u0648\u0631\u062F\u064A\u0629 "),i(11,"span",17),o(12,"*"),n()(),i(13,"input",18),v("ngModelChange",function(u){c(t);let m=d();return h(m.shift.name,u)||(m.shift.name=u),p(u)}),n(),f(14,rt,2,0,"div",19),n(),i(15,"div",15)(16,"label",20),o(17,"\u0648\u0642\u062A \u0627\u0644\u0628\u062F\u0627\u064A\u0629 "),i(18,"span",17),o(19,"*"),n()(),i(20,"input",21),v("ngModelChange",function(u){c(t);let m=d();return h(m.shift.start_time,u)||(m.shift.start_time=u),p(u)}),n(),f(21,ut,2,0,"div",19),i(22,"small",22),o(23,"\u062A\u0646\u0633\u064A\u0642 24 \u0633\u0627\u0639\u0629 (HH:MM)"),n()(),i(24,"div",15)(25,"label",23),o(26,"\u0639\u062F\u062F \u0627\u0644\u0633\u0627\u0639\u0627\u062A "),i(27,"span",17),o(28,"*"),n()(),i(29,"input",24),v("ngModelChange",function(u){c(t);let m=d();return h(m.shift.duration_hours,u)||(m.shift.duration_hours=u),p(u)}),n(),f(30,ot,2,0,"div",19),i(31,"small",22),o(32,"\u0639\u062F\u062F \u0633\u0627\u0639\u0627\u062A \u0627\u0644\u0639\u0645\u0644 \u0641\u064A \u0627\u0644\u0648\u0631\u062F\u064A\u0629"),n()(),i(33,"div",15)(34,"label",25),o(35,"\u0633\u0645\u0627\u062D \u062A\u0623\u062E\u064A\u0631 \u0627\u0644\u062F\u062E\u0648\u0644 (\u062F\u0642\u064A\u0642\u0629)"),n(),i(36,"input",26),v("ngModelChange",function(u){c(t);let m=d();return h(m.shift.checkin_grace_minutes,u)||(m.shift.checkin_grace_minutes=u),p(u)}),n(),i(37,"small",22),o(38,"\u0639\u062F\u062F \u0627\u0644\u062F\u0642\u0627\u0626\u0642 \u0627\u0644\u0645\u0633\u0645\u0648\u062D \u0628\u0647\u0627 \u0644\u0644\u062A\u0623\u062E\u064A\u0631 \u0641\u064A \u0627\u0644\u062F\u062E\u0648\u0644"),n()(),i(39,"div",15)(40,"label",27),o(41,"\u0633\u0645\u0627\u062D \u062A\u0623\u062E\u064A\u0631 \u0627\u0644\u062E\u0631\u0648\u062C (\u062F\u0642\u064A\u0642\u0629)"),n(),i(42,"input",28),v("ngModelChange",function(u){c(t);let m=d();return h(m.shift.checkout_grace_minutes,u)||(m.shift.checkout_grace_minutes=u),p(u)}),n(),i(43,"small",22),o(44,"\u0639\u062F\u062F \u0627\u0644\u062F\u0642\u0627\u0626\u0642 \u0627\u0644\u0645\u0633\u0645\u0648\u062D \u0628\u0647\u0627 \u0644\u0644\u062A\u0623\u062E\u064A\u0631 \u0641\u064A \u0627\u0644\u062E\u0631\u0648\u062C"),n()()()(),f(45,at,19,3,"div",29),i(46,"div",30)(47,"app-button",31),o(48),n(),i(49,"app-button",32),b("btnClick",function(){c(t);let u=d();return p(u.goBack())}),o(50," \u0625\u0644\u063A\u0627\u0621 "),n()(),f(51,st,5,1,"div",33),n()()()}if(s&2){let t=P(3),e=d();a(),l("title","\u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629")("subtitle",e.shiftId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629":"\u0625\u062F\u062E\u0627\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629 \u0627\u0644\u062C\u062F\u064A\u062F\u0629"),a(12),C("is-invalid",e.submitted&&t.controls.name.errors),g("ngModel",e.shift.name),a(),l("ngIf",e.submitted&&(t.controls.name==null?null:t.controls.name.errors)),a(6),C("is-invalid",e.submitted&&t.controls.start_time.errors),g("ngModel",e.shift.start_time),a(),l("ngIf",e.submitted&&(t.controls.start_time==null?null:t.controls.start_time.errors)),a(8),C("is-invalid",e.submitted&&t.controls.duration_hours.errors),g("ngModel",e.shift.duration_hours),a(),l("ngIf",e.submitted&&(t.controls.duration_hours==null?null:t.controls.duration_hours.errors)),a(6),g("ngModel",e.shift.checkin_grace_minutes),a(6),g("ngModel",e.shift.checkout_grace_minutes),a(3),l("ngIf",e.shift.start_time&&e.shift.duration_hours),a(2),l("loading",e.saving)("disabled",!t.form.valid||e.saving),a(),F(" ",e.shiftId?"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A":"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0648\u0631\u062F\u064A\u0629"," "),a(),l("disabled",e.saving),a(2),l("ngIf",e.formError)}}var Y=class s{constructor(r,t,e){this.route=r;this.router=t;this.sb=e}shift={name:"",start_time:"",duration_hours:8,checkin_grace_minutes:0,checkout_grace_minutes:0};shiftId=null;loading=!1;saving=!1;submitted=!1;error="";formError="";ngOnInit(){this.shiftId=this.route.snapshot.paramMap.get("id"),this.shiftId&&this.loadShift()}loadShift(){return A(this,null,function*(){if(this.shiftId)try{this.loading=!0,this.error="";let{data:r,error:t}=yield this.sb.rpc("shifts_get_by_id",{_id:this.shiftId});if(t)throw t;this.shift={name:r.name||"",start_time:this.convertTimeToHHMM(r.start_time||""),duration_hours:r.duration_hours||8,checkin_grace_minutes:r.checkin_grace_minutes||0,checkout_grace_minutes:r.checkout_grace_minutes||0}}catch(r){console.error("Error loading shift:",r),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629"}finally{this.loading=!1}})}onSubmit(){return A(this,null,function*(){if(this.submitted=!0,this.formError="",!this.shift.name||!this.shift.start_time||!this.shift.duration_hours){this.formError="\u064A\u0631\u062C\u0649 \u0645\u0644\u0621 \u062C\u0645\u064A\u0639 \u0627\u0644\u062D\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629";return}if(!this.isValidTime(this.shift.start_time)){this.formError="\u0635\u064A\u063A\u0629 \u0648\u0642\u062A \u0627\u0644\u0628\u062F\u0627\u064A\u0629 \u063A\u064A\u0631 \u0635\u062D\u064A\u062D\u0629 (HH:mm)";return}let r=parseInt(this.shift.duration_hours,10);if(!Number.isInteger(r)||r<1){this.formError="\u0639\u062F\u062F \u0627\u0644\u0633\u0627\u0639\u0627\u062A \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0639\u062F\u062F\u064B\u0627 \u0635\u062D\u064A\u062D\u064B\u0627 \u0645\u0648\u062C\u0628\u064B\u0627";return}let t=parseInt(this.shift.checkin_grace_minutes,10)||0,e=parseInt(this.shift.checkout_grace_minutes,10)||0;if(t<0||e<0){this.formError="\u0642\u064A\u0645 \u0627\u0644\u0633\u0645\u0627\u062D \u064A\u062C\u0628 \u0623\u0646 \u062A\u0643\u0648\u0646 \u0623\u0639\u062F\u0627\u062F\u064B\u0627 \u0635\u062D\u064A\u062D\u0629 \u0635\u0641\u0631\u064A\u0629 \u0623\u0648 \u0645\u0648\u062C\u0628\u0629";return}try{this.saving=!0;let u=this.shift.start_time;if(this.shiftId){let{error:m}=yield this.sb.rpc("shifts_update",{_id:this.shiftId,_name:this.shift.name.trim(),_start_time:u,_duration_hours:r,_checkin_grace_minutes:t,_checkout_grace_minutes:e});if(m)throw m}else{let{error:m}=yield this.sb.rpc("shifts_insert",{_name:this.shift.name.trim(),_start_time:u,_duration_hours:r,_checkin_grace_minutes:t,_checkout_grace_minutes:e});if(m)throw m}this.router.navigate(["/shifts"])}catch(u){console.error("Error saving shift:",u),this.formError=this.shiftId?"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0648\u0631\u062F\u064A\u0629":"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0648\u0631\u062F\u064A\u0629"}finally{this.saving=!1}})}goBack(){this.router.navigate(["/shifts"])}isValidTime(r){return/^([01]\d|2[0-3]):[0-5]\d$/.test(String(r))}convertTimeToInterval(r){return!r||!this.isValidTime(r)?"00:00:00":r+":00"}convertTimeToHHMM(r){if(!r)return"";let t=r.split(":");if(t.length>=2){let e=t[0].padStart(2,"0"),u=t[1].padStart(2,"0");return`${e}:${u}`}return r}computeEndTime(r,t){if(!r||t==null)return"-";let[e,u]=String(r).split(":"),m=Number(e),y=Number(u);if(Number.isNaN(m)||Number.isNaN(y))return"-";let Z=m*60+y,$=Math.round(Number(t)*60),E=(Z+$)%1440,tt=Math.floor(E/60),et=E%60,w=S=>S<10?"0"+S:String(S);return`${w(tt)}:${w(et)}`}static \u0275fac=function(t){return new(t||s)(x(V),x(N),x(D))};static \u0275cmp=k({type:s,selectors:[["app-shifts-form"]],decls:11,vars:6,consts:[["shiftForm","ngForm"],[1,"page-header"],[1,"header-content"],[1,"page-subtitle"],["variant","outline",3,"btnClick","disabled"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629...",3,"overlay",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629...",3,"overlay"],[1,"error-message"],["variant","outline","size","sm",3,"btnClick"],[3,"title","subtitle"],[1,"shift-form",3,"ngSubmit"],[1,"form-section"],[1,"form-grid"],[1,"form-group"],["for","name"],[1,"required"],["type","text","id","name","name","name","required","","placeholder","\u0623\u062F\u062E\u0644 \u0627\u0633\u0645 \u0627\u0644\u0648\u0631\u062F\u064A\u0629",1,"form-control",3,"ngModelChange","ngModel"],["class","invalid-feedback",4,"ngIf"],["for","start_time"],["type","time","id","start_time","name","start_time","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-hint"],["for","duration_hours"],["type","number","id","duration_hours","name","duration_hours","required","","min","1","step","1","placeholder","8",1,"form-control",3,"ngModelChange","ngModel"],["for","checkin_grace_minutes"],["type","number","id","checkin_grace_minutes","name","checkin_grace_minutes","min","0","step","1","placeholder","0",1,"form-control",3,"ngModelChange","ngModel"],["for","checkout_grace_minutes"],["type","number","id","checkout_grace_minutes","name","checkout_grace_minutes","min","0","step","1","placeholder","0",1,"form-control",3,"ngModelChange","ngModel"],["class","form-section",4,"ngIf"],[1,"form-actions"],["type","submit","variant","primary",3,"loading","disabled"],["type","button","variant","outline",3,"btnClick","disabled"],["class","form-error",4,"ngIf"],[1,"invalid-feedback"],[1,"preview-container"],[1,"preview-item"],[1,"time-badge"],[1,"duration-text"],[1,"form-error"]],template:function(t,e){t&1&&(i(0,"div",1)(1,"div",2)(2,"h1"),o(3),n(),i(4,"p",3),o(5),n()(),i(6,"app-button",4),b("btnClick",function(){return e.goBack()}),o(7," \u2190 \u0631\u062C\u0648\u0639 \u0644\u0644\u0642\u0627\u0626\u0645\u0629 "),n()(),f(8,it,1,1,"app-spinner",5)(9,nt,7,1,"div",6)(10,mt,52,22,"div",7)),t&2&&(a(3),_(e.shiftId?"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0648\u0631\u062F\u064A\u0629":"\u0625\u0636\u0627\u0641\u0629 \u0648\u0631\u062F\u064A\u0629 \u062C\u062F\u064A\u062F\u0629"),a(2),_(e.shiftId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629 \u0627\u0644\u0645\u062D\u062F\u062F\u0629":"\u0625\u0636\u0627\u0641\u0629 \u0648\u0631\u062F\u064A\u0629 \u0639\u0645\u0644 \u062C\u062F\u064A\u062F\u0629 \u0644\u0644\u0646\u0638\u0627\u0645"),a(),l("disabled",e.saving),a(2),l("ngIf",e.loading),a(),l("ngIf",e.error&&!e.loading),a(),l("ngIf",!e.loading&&!e.error))},dependencies:[T,O,K,q,z,L,B,H,J,G,j,R,W,U,Q,X],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--color-primary-dark);font-size:1.8rem}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--muted-text);font-size:1rem}.shift-form[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.form-section[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:8px;padding:1.5rem;background:#fafafa;margin-bottom:2rem}.form-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--color-primary-dark);font-size:1.1rem;border-bottom:1px solid var(--border-color);padding-bottom:.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-color)}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:6px;font-size:1rem;line-height:1.5;background:#fff;transition:all .2s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px #f6b81933}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 2px #dc354533}.invalid-feedback[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#dc3545}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.8rem;color:var(--muted-text)}.preview-container[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border-color);border-radius:8px;padding:1rem}.preview-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.5rem 0;border-bottom:1px dashed var(--border-color)}.preview-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.preview-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:0;font-weight:600;color:var(--text-color)}.time-badge[_ngcontent-%COMP%]{display:inline-block;background:var(--color-primary);color:#fff;padding:.25rem .5rem;border-radius:4px;font-size:.9rem;font-weight:600;font-family:monospace}.duration-text[_ngcontent-%COMP%]{font-weight:600;color:var(--color-primary-dark)}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:1rem;border-top:1px solid var(--border-color)}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#c62828;flex:1}.form-error[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:6px;padding:1rem;display:flex;align-items:center;gap:.5rem;color:#c62828;margin-top:1rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.form-section[_ngcontent-%COMP%]{padding:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.preview-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}"]})};export{Y as ShiftsFormComponent};
