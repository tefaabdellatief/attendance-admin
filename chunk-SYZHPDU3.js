import{a as X}from"./chunk-VJJD6Q4W.js";import{c as T,d as N,e as z,f as W,g as B,h as R,i as q,j,k as U,l as L,n as G,o as H,p as J,q as K,r as Q}from"./chunk-OVLE5S5M.js";import{a as k}from"./chunk-VRPC7EEM.js";import"./chunk-X5YLR3NI.js";import{$ as r,B as C,C as M,Ca as I,G as g,Ia as P,Ka as D,M as s,N as n,O as i,Oa as V,P as F,S as E,T as _,U as l,X as S,Z as b,aa as v,ba as A,da as x,ea as h,fa as y,n as c,o as p,wa as w,xa as O,z as a}from"./chunk-JMF3YSV7.js";import{i as f}from"./chunk-ODN5LVDJ.js";function Z(u,o){u&1&&F(0,"app-spinner",8),u&2&&s("overlay",!1)}function $(u,o){if(u&1){let e=E();n(0,"div",9)(1,"span"),r(2,"\u26A0\uFE0F"),i(),n(3,"p"),r(4),i(),n(5,"app-button",10),_("btnClick",function(){c(e);let d=l();return p(d.loadDeduction())}),r(6,"\u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629"),i()()}if(u&2){let e=l();a(4),v(e.error)}}function ee(u,o){if(u&1&&(n(0,"option",32),r(1),i()),u&2){let e=o.$implicit;s("ngValue",e.id),a(),A(" ",e.full_name||e.username," ")}}function te(u,o){u&1&&(n(0,"div",33),r(1," \u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 "),i())}function ne(u,o){u&1&&(n(0,"div",33),r(1," \u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0645\u0628\u0644\u063A \u0635\u062D\u064A\u062D \u0623\u0643\u0628\u0631 \u0645\u0646 \u0635\u0641\u0631 "),i())}function ie(u,o){u&1&&(n(0,"div",33),r(1," \u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0633\u0628\u0628 \u0627\u0644\u062E\u0635\u0645 "),i())}function oe(u,o){if(u&1&&(n(0,"div",34)(1,"span"),r(2,"\u26A0\uFE0F"),i(),n(3,"p"),r(4),i()()),u&2){let e=l(2);a(4),v(e.formError)}}function re(u,o){if(u&1){let e=E();n(0,"div")(1,"app-card",11)(2,"form",12,0),_("ngSubmit",function(){c(e);let d=l();return p(d.onSubmit())}),n(4,"div",13)(5,"h4"),r(6,"\u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062A \u0627\u0644\u0623\u0633\u0627\u0633\u064A\u0629"),i(),n(7,"div",14)(8,"div",15)(9,"label",16),r(10,"\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 "),n(11,"span",17),r(12,"*"),i()(),n(13,"select",18),y("ngModelChange",function(d){c(e);let m=l();return h(m.deduction.user_id,d)||(m.deduction.user_id=d),p(d)}),n(14,"option",19),r(15,"\u0627\u062E\u062A\u0631 \u0645\u0633\u062A\u062E\u062F\u0645\u064B\u0627"),i(),g(16,ee,2,2,"option",20),i(),g(17,te,2,0,"div",21),i(),n(18,"div",15)(19,"label",22),r(20,"\u0627\u0644\u0645\u0628\u0644\u063A (\u062C\u0646\u064A\u0647) "),n(21,"span",17),r(22,"*"),i()(),n(23,"input",23),y("ngModelChange",function(d){c(e);let m=l();return h(m.deduction.amount,d)||(m.deduction.amount=d),p(d)}),i(),g(24,ne,2,0,"div",21),n(25,"small",24),r(26,"\u0627\u0644\u0645\u0628\u0644\u063A \u0628\u0627\u0644\u062C\u0646\u064A\u0647 \u0627\u0644\u0645\u0635\u0631\u064A"),i()(),n(27,"div",25)(28,"label",26),r(29,"\u0633\u0628\u0628 \u0627\u0644\u062E\u0635\u0645 "),n(30,"span",17),r(31,"*"),i()(),n(32,"textarea",27),y("ngModelChange",function(d){c(e);let m=l();return h(m.deduction.reason,d)||(m.deduction.reason=d),p(d)}),r(33,"                "),i(),g(34,ie,2,0,"div",21),n(35,"small",24),r(36,"\u0648\u0635\u0641 \u0645\u0641\u0635\u0644 \u0644\u0633\u0628\u0628 \u0627\u0644\u062E\u0635\u0645"),i()()()(),n(37,"div",28)(38,"app-button",29),r(39),i(),n(40,"app-button",30),_("btnClick",function(){c(e);let d=l();return p(d.goBack())}),r(41," \u0625\u0644\u063A\u0627\u0621 "),i()(),g(42,oe,5,1,"div",31),i()()()}if(u&2){let e=S(3),t=l();a(),s("title","\u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645")("subtitle",t.deductionId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645":"\u0625\u062F\u062E\u0627\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645 \u0627\u0644\u062C\u062F\u064A\u062F"),a(12),b("is-invalid",t.submitted&&e.controls.user_id.errors),x("ngModel",t.deduction.user_id),a(),s("ngValue",null),a(2),s("ngForOf",t.users),a(),s("ngIf",t.submitted&&(e.controls.user_id==null?null:e.controls.user_id.errors)),a(6),b("is-invalid",t.submitted&&e.controls.amount.errors),x("ngModel",t.deduction.amount),a(),s("ngIf",t.submitted&&(e.controls.amount==null?null:e.controls.amount.errors)),a(8),b("is-invalid",t.submitted&&e.controls.reason.errors),x("ngModel",t.deduction.reason),a(2),s("ngIf",t.submitted&&(e.controls.reason==null?null:e.controls.reason.errors)),a(4),s("loading",t.saving)("disabled",!e.form.valid||t.saving),a(),A(" ",t.deductionId?"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A":"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062E\u0635\u0645"," "),a(),s("disabled",t.saving),a(2),s("ngIf",t.formError)}}var Y=class u{constructor(o,e,t){this.route=o;this.router=e;this.sb=t}deduction={user_id:null,amount:null,reason:""};users=[];deductionId=null;loading=!1;saving=!1;submitted=!1;error="";formError="";ngOnInit(){return f(this,null,function*(){this.deductionId=this.route.snapshot.paramMap.get("id"),yield this.loadUsers(),this.deductionId&&(yield this.loadDeduction())})}loadUsers(){return f(this,null,function*(){try{let{data:o}=yield this.sb.rpc("users_get");this.users=o||[]}catch(o){console.error("Error loading users:",o),this.users=[]}})}loadDeduction(){return f(this,null,function*(){if(this.deductionId)try{this.loading=!0,this.error="";let{data:o,error:e}=yield this.sb.rpc("deductions_get_by_id",{_id:this.deductionId});if(e)throw e;this.deduction={user_id:o.user_id,amount:o.amount,reason:o.reason||""}}catch(o){console.error("Error loading deduction:",o),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645"}finally{this.loading=!1}})}onSubmit(){return f(this,null,function*(){if(this.submitted=!0,this.formError="",!this.deduction.user_id||!this.deduction.amount||!this.deduction.reason?.trim()){this.formError="\u064A\u0631\u062C\u0649 \u0645\u0644\u0621 \u062C\u0645\u064A\u0639 \u0627\u0644\u062D\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629";return}if(this.deduction.amount<=0){this.formError="\u0627\u0644\u0645\u0628\u0644\u063A \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0635\u0641\u0631";return}try{this.saving=!0;let o=this.sb.getCurrentUser();if(!o?.id){this.formError="\u0644\u0627 \u064A\u0648\u062C\u062F \u0645\u0633\u062A\u062E\u062F\u0645 \u0645\u0633\u062C\u0644 \u062F\u062E\u0648\u0644\u064B\u0627 \u0644\u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u062E\u0635\u0645";return}let e={user_id:this.deduction.user_id,amount:parseFloat(this.deduction.amount),reason:this.deduction.reason.trim()};if(this.deductionId){let{error:t}=yield this.sb.rpc("deductions_update",{_id:this.deductionId,_amount:e.amount,_reason:e.reason});if(t)throw t}else{let{error:t}=yield this.sb.rpc("deductions_insert",{_user_id:e.user_id,_amount:e.amount,_reason:e.reason,_created_by:o.id});if(t)throw t}this.router.navigate(["/deductions"])}catch(o){console.error("Error saving deduction:",o),this.formError=this.deductionId?"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u062E\u0635\u0645":"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062E\u0635\u0645"}finally{this.saving=!1}})}goBack(){this.router.navigate(["/deductions"])}static \u0275fac=function(e){return new(e||u)(C(P),C(D),C(k))};static \u0275cmp=M({type:u,selectors:[["app-deductions-form"]],decls:11,vars:6,consts:[["deductionForm","ngForm"],[1,"page-header"],[1,"header-content"],[1,"page-subtitle"],["variant","outline",3,"btnClick","disabled"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645...",3,"overlay",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645...",3,"overlay"],[1,"error-message"],["variant","outline","size","sm",3,"btnClick"],[3,"title","subtitle"],[1,"deduction-form",3,"ngSubmit"],[1,"form-section"],[1,"form-grid"],[1,"form-group"],["for","user_id"],[1,"required"],["id","user_id","name","user_id","required","",1,"form-control",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["for","amount"],["type","number","id","amount","name","amount","required","","min","0.01","step","0.01","placeholder","\u0623\u062F\u062E\u0644 \u0627\u0644\u0645\u0628\u0644\u063A",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-hint"],[1,"form-group","full-width"],["for","reason"],["id","reason","name","reason","required","","rows","3","placeholder","\u0623\u062F\u062E\u0644 \u0633\u0628\u0628 \u0627\u0644\u062E\u0635\u0645",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","submit","variant","primary",3,"loading","disabled"],["type","button","variant","outline",3,"btnClick","disabled"],["class","form-error",4,"ngIf"],[3,"ngValue"],[1,"invalid-feedback"],[1,"form-error"]],template:function(e,t){e&1&&(n(0,"div",1)(1,"div",2)(2,"h1"),r(3),i(),n(4,"p",3),r(5),i()(),n(6,"app-button",4),_("btnClick",function(){return t.goBack()}),r(7," \u2190 \u0631\u062C\u0648\u0639 \u0644\u0644\u0642\u0627\u0626\u0645\u0629 "),i()(),g(8,Z,1,1,"app-spinner",5)(9,$,7,1,"div",6)(10,re,43,21,"div",7)),e&2&&(a(3),v(t.deductionId?"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u062E\u0635\u0645":"\u0625\u0636\u0627\u0641\u0629 \u062E\u0635\u0645 \u062C\u062F\u064A\u062F"),a(2),v(t.deductionId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u062E\u0635\u0645 \u0627\u0644\u0645\u062D\u062F\u062F":"\u0625\u0636\u0627\u0641\u0629 \u062E\u0635\u0645 \u062C\u062F\u064A\u062F \u0644\u0644\u0645\u0648\u0638\u0641"),a(),s("disabled",t.saving),a(2),s("ngIf",t.loading),a(),s("ngIf",t.error&&!t.loading),a(),s("ngIf",!t.loading&&!t.error))},dependencies:[I,w,O,J,R,U,L,T,q,j,N,z,H,G,B,W,V,Q,K,X],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--color-primary-dark);font-size:1.8rem}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--muted-text);font-size:1rem}.deduction-form[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.form-section[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:8px;padding:1.5rem;background:#fafafa;margin-bottom:2rem}.form-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--color-primary-dark);font-size:1.1rem;border-bottom:1px solid var(--border-color);padding-bottom:.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group.full-width[_ngcontent-%COMP%]{grid-column:1/-1}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-color)}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:6px;font-size:1rem;line-height:1.5;background:#fff;transition:all .2s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px #f6b81933}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 2px #dc354533}.invalid-feedback[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#dc3545}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.8rem;color:var(--muted-text)}textarea.form-control[_ngcontent-%COMP%]{min-height:100px;resize:vertical;line-height:1.5}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:1rem;border-top:1px solid var(--border-color)}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#c62828;flex:1}.form-error[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:6px;padding:1rem;display:flex;align-items:center;gap:.5rem;color:#c62828;margin-top:1rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.form-section[_ngcontent-%COMP%]{padding:1rem}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-actions[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{Y as DeductionsFormComponent};
