import{a as G}from"./chunk-VJJD6Q4W.js";import{c as k,d as V,e as z,f as N,g as R,h as B,o as W,p as j,q,r as L}from"./chunk-OVLE5S5M.js";import{a as D}from"./chunk-VRPC7EEM.js";import"./chunk-X5YLR3NI.js";import{$ as u,B as _,C as A,Ca as I,G as y,Ia as P,Ka as O,M as d,N as n,O as i,Oa as T,P as M,S as b,T as g,U as s,X as F,Z as w,aa as f,ba as E,da as v,ea as x,fa as h,n as p,o as l,xa as S,z as o}from"./chunk-JMF3YSV7.js";import{i as C}from"./chunk-ODN5LVDJ.js";function J(a,r){a&1&&M(0,"app-spinner",8),a&2&&d("overlay",!1)}function K(a,r){if(a&1){let t=b();n(0,"div",9)(1,"span"),u(2,"\u26A0\uFE0F"),i(),n(3,"p"),u(4),i(),n(5,"app-button",10),g("btnClick",function(){p(t);let m=s();return l(m.loadType())}),u(6,"\u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629"),i()()}if(a&2){let t=s();o(4),f(t.error)}}function Q(a,r){a&1&&(n(0,"div",27),u(1," \u0627\u0633\u0645 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0645\u0637\u0644\u0648\u0628 "),i())}function U(a,r){if(a&1&&(n(0,"div",28)(1,"span"),u(2,"\u26A0\uFE0F"),i(),n(3,"p"),u(4),i()()),a&2){let t=s(2);o(4),f(t.formError)}}function X(a,r){if(a&1){let t=b();n(0,"div")(1,"app-card",11)(2,"form",12,0),g("ngSubmit",function(){p(t);let m=s();return l(m.onSubmit())}),n(4,"div",13)(5,"h4"),u(6,"\u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062A \u0627\u0644\u0623\u0633\u0627\u0633\u064A\u0629"),i(),n(7,"div",14)(8,"div",15)(9,"label",16),u(10,"\u0627\u0633\u0645 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 "),n(11,"span",17),u(12,"*"),i()(),n(13,"input",18),h("ngModelChange",function(m){p(t);let c=s();return x(c.type.name,m)||(c.type.name=m),l(m)}),i(),y(14,Q,2,0,"div",19),n(15,"small",20),u(16,"\u0645\u062B\u0627\u0644: \u062F\u062E\u0648\u0644\u060C \u0627\u0646\u0635\u0631\u0627\u0641\u060C \u0627\u0633\u062A\u0631\u0627\u062D\u0629\u060C \u0625\u0644\u062E"),i()(),n(17,"div",15)(18,"label",21),u(19,"\u0627\u0644\u0648\u0635\u0641"),i(),n(20,"textarea",22),h("ngModelChange",function(m){p(t);let c=s();return x(c.type.description,m)||(c.type.description=m),l(m)}),u(21,"                "),i(),n(22,"small",20),u(23,"\u0648\u0635\u0641 \u0645\u0641\u0635\u0644 \u0644\u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)"),i()()()(),n(24,"div",23)(25,"app-button",24),u(26),i(),n(27,"app-button",25),g("btnClick",function(){p(t);let m=s();return l(m.goBack())}),u(28," \u0625\u0644\u063A\u0627\u0621 "),i()(),y(29,U,5,1,"div",26),i()()()}if(a&2){let t=F(3),e=s();o(),d("title","\u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631")("subtitle",e.typeId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631":"\u0625\u062F\u062E\u0627\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0627\u0644\u062C\u062F\u064A\u062F"),o(12),w("is-invalid",e.submitted&&t.controls.name.errors),v("ngModel",e.type.name),o(),d("ngIf",e.submitted&&(t.controls.name==null?null:t.controls.name.errors)),o(6),v("ngModel",e.type.description),o(5),d("loading",e.saving)("disabled",!t.form.valid||e.saving),o(),E(" ",e.typeId?"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A":"\u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"," "),o(),d("disabled",e.saving),o(2),d("ngIf",e.formError)}}var H=class a{constructor(r,t,e){this.route=r;this.router=t;this.sb=e}type={name:"",description:""};typeId=null;loading=!1;saving=!1;submitted=!1;error="";formError="";ngOnInit(){this.typeId=this.route.snapshot.paramMap.get("id"),this.typeId&&this.loadType()}loadType(){return C(this,null,function*(){if(this.typeId)try{this.loading=!0,this.error="";let{data:r,error:t}=yield this.sb.rpc("attendance_types_get_by_id",{_id:this.typeId});if(t)throw t;this.type={name:r.name||"",description:r.description||""}}catch(r){console.error("Error loading type:",r),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"}finally{this.loading=!1}})}onSubmit(){return C(this,null,function*(){if(this.submitted=!0,this.formError="",!this.type.name||!this.type.name.trim()){this.formError="\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0627\u0633\u0645 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631";return}try{if(this.saving=!0,this.typeId){let{error:r}=yield this.sb.rpc("attendance_types_update",{_id:this.typeId,_name:this.type.name.trim(),_description:this.type.description?.trim()||null});if(r)throw r}else{let{error:r}=yield this.sb.rpc("attendance_types_insert",{_name:this.type.name.trim(),_description:this.type.description?.trim()||null});if(r)throw r}this.router.navigate(["/attendance-types"])}catch(r){console.error("Error saving type:",r),this.formError=this.typeId?"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u062F\u064A\u062B \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631":"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631"}finally{this.saving=!1}})}goBack(){this.router.navigate(["/attendance-types"])}static \u0275fac=function(t){return new(t||a)(_(P),_(O),_(D))};static \u0275cmp=A({type:a,selectors:[["app-attendance-types-form"]],decls:11,vars:6,consts:[["typeForm","ngForm"],[1,"page-header"],[1,"header-content"],[1,"page-subtitle"],["variant","outline",3,"btnClick","disabled"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631...",3,"overlay",4,"ngIf"],["class","error-message",4,"ngIf"],[4,"ngIf"],["message","\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631...",3,"overlay"],[1,"error-message"],["variant","outline","size","sm",3,"btnClick"],[3,"title","subtitle"],[1,"type-form",3,"ngSubmit"],[1,"form-section"],[1,"form-grid"],[1,"form-group","full-width"],["for","name"],[1,"required"],["type","text","id","name","name","name","required","","placeholder","\u0623\u062F\u062E\u0644 \u0627\u0633\u0645 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631",1,"form-control",3,"ngModelChange","ngModel"],["class","invalid-feedback",4,"ngIf"],[1,"form-hint"],["for","description"],["id","description","name","description","rows","3","placeholder","\u0623\u062F\u062E\u0644 \u0648\u0635\u0641 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 (\u0627\u062E\u062A\u064A\u0627\u0631\u064A)",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","submit","variant","primary",3,"loading","disabled"],["type","button","variant","outline",3,"btnClick","disabled"],["class","form-error",4,"ngIf"],[1,"invalid-feedback"],[1,"form-error"]],template:function(t,e){t&1&&(n(0,"div",1)(1,"div",2)(2,"h1"),u(3),i(),n(4,"p",3),u(5),i()(),n(6,"app-button",4),g("btnClick",function(){return e.goBack()}),u(7," \u2190 \u0631\u062C\u0648\u0639 \u0644\u0644\u0642\u0627\u0626\u0645\u0629 "),i()(),y(8,J,1,1,"app-spinner",5)(9,K,7,1,"div",6)(10,X,30,12,"div",7)),t&2&&(o(3),f(e.typeId?"\u062A\u0639\u062F\u064A\u0644 \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631":"\u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u062D\u0636\u0648\u0631 \u062C\u062F\u064A\u062F"),o(2),f(e.typeId?"\u062A\u0639\u062F\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0646\u0648\u0639 \u0627\u0644\u062D\u0636\u0648\u0631 \u0627\u0644\u0645\u062D\u062F\u062F":"\u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u062D\u0636\u0648\u0631 \u062C\u062F\u064A\u062F \u0644\u0644\u0646\u0638\u0627\u0645"),o(),d("disabled",e.saving),o(2),d("ngIf",e.loading),o(),d("ngIf",e.error&&!e.loading),o(),d("ngIf",!e.loading&&!e.error))},dependencies:[I,S,j,B,k,V,z,W,R,N,T,L,q,G],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:1rem}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--color-primary-dark);font-size:1.8rem}.page-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--muted-text);font-size:1rem}.type-form[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.form-section[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:8px;padding:1.5rem;background:#fafafa;margin-bottom:2rem}.form-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--color-primary-dark);font-size:1.1rem;border-bottom:1px solid var(--border-color);padding-bottom:.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group.full-width[_ngcontent-%COMP%]{grid-column:1/-1}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-color)}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:6px;font-size:1rem;line-height:1.5;background:#fff;transition:all .2s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px #f6b81933}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 2px #dc354533}.invalid-feedback[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#dc3545}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.8rem;color:var(--muted-text)}textarea.form-control[_ngcontent-%COMP%]{min-height:100px;resize:vertical;line-height:1.5}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:2rem;padding-top:1rem;border-top:1px solid var(--border-color)}.error-message[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#c62828;flex:1}.form-error[_ngcontent-%COMP%]{background:#fee;border:1px solid #fcc;border-radius:6px;padding:1rem;display:flex;align-items:center;gap:.5rem;color:#c62828;margin-top:1rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.form-section[_ngcontent-%COMP%]{padding:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{H as AttendanceTypesFormComponent};
