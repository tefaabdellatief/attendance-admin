<div class="page-container">
  <div class="page-header">
    <h1>حساب الراتب الفوري</h1>
    <p class="subtitle">احسب الراتب بناءً على بيانات الحضور والانصراف</p>
  </div>

  <div class="card form-card">
    <form (ngSubmit)="calculateSalary()" #salaryForm="ngForm">
      <!-- Row 1: User and Base Salary -->
      <div class="form-row">
        <div class="form-field">
          <label for="user">الموظف</label>
          <select id="user" [(ngModel)]="form.user_id" name="user_id" class="form-control" required>
            <option *ngFor="let user of users" [value]="user.id">{{ user.full_name }}</option>
          </select>
        </div>

        <div class="form-field">
          <label for="base_salary">الراتب الأساسي</label>
          <div class="input-group">
            <input type="number" id="base_salary" [(ngModel)]="form.base_salary" name="base_salary" class="form-control" min="0" step="0.01" required>
            <span class="input-group-text">ج.م</span>
          </div>
        </div>
      </div>

      <!-- Row 2: Date Range -->
      <div class="form-row">
        <div class="form-field">
          <label for="start_date">من تاريخ</label>
          <input type="date" id="start_date" [(ngModel)]="form.start_date" name="start_date" class="form-control" required>
        </div>

        <div class="form-field">
          <label for="end_date">إلى تاريخ</label>
          <input type="date" id="end_date" [(ngModel)]="form.end_date" name="end_date" class="form-control" required>
        </div>
      </div>

      <!-- Row 3: Days Off and Shift Time -->
      <div class="form-row">
        <div class="form-field">
          <label for="allowed_off_days">أيام الإجازة المسموح بها</label>
          <input type="number" id="allowed_off_days" [(ngModel)]="form.allowed_off_days" name="allowed_off_days" class="form-control" min="0" required>
        </div>

        <div class="form-field">
          <label for="shift_hours">مدة الوردية (ساعات)</label>
          <div class="input-group">
            <input type="number" id="shift_hours" [(ngModel)]="form.shift_hours" name="shift_hours" class="form-control" min="1" max="24" step="0.5" required>
            <span class="input-group-text">ساعة</span>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <app-button 
          type="submit" 
          [loading]="loading"
          [disabled]="!salaryForm.form.valid || loading">
          احسب الراتب
        </app-button>
      </div>
    </form>
  </div>

  <div *ngIf="error" class="error-message">
    <span>⚠️</span>
    <p>{{ error }}</p>
  </div>

  <div *ngIf="loading" class="loading-container">
    <app-spinner></app-spinner>
  </div>

  <div *ngIf="salaryData" class="salary-results">
    <div class="card">
      <h3>نتيجة حساب الراتب</h3>
      
      <div class="salary-summary">
        <div class="summary-row">
          <div class="summary-item">
            <span class="label">الفترة من</span>
            <span class="value">{{ salaryData.start_date | date: 'yyyy/MM/dd' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">إلى</span>
            <span class="value">{{ salaryData.end_date | date: 'yyyy/MM/dd' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">إجمالي الأيام</span>
            <span class="value">{{ salaryData.days_in_range }}</span>
          </div>
        </div>
      </div>

      <div class="salary-details">
        <div class="details-row">
          <div class="details-group">
            <h4>تفاصيل الراتب</h4>
            <div class="detail-item">
              <span class="label">الراتب الأساسي</span>
              <span class="value">{{ salaryData.base_salary | number:'1.2-2' }} ج.م</span>
            </div>
            <div class="detail-item">
              <span class="label">أيام العمل الفعلية</span>
              <span class="value">{{ salaryData.working_days }} يوم</span>
            </div>
            <div class="detail-item">
              <span class="label">مدة الوردية</span>
              <span class="value">{{ salaryData.shift_hours }} ساعة</span>
            </div>
          </div>

          <div class="details-group">
            <h4>الحضور والانصراف</h4>
            <div class="detail-item">
              <span class="label">أيام الحضور</span>
              <span class="value">{{ salaryData.present_days }} يوم</span>
            </div>
            <div class="detail-item">
              <span class="label">أيام الغياب</span>
              <span class="value">{{ salaryData.absent_days }} يوم</span>
            </div>
            <div class="detail-item">
              <span class="label">أيام الإجازة المسموح بها</span>
              <span class="value">{{ salaryData.allowed_off_days }} يوم</span>
            </div>
          </div>
        </div>

        <div class="details-row">
          <div class="details-group">
            <h4>تفاصيل الوقت</h4>
            <div class="detail-item">
              <span class="label">إجمالي ساعات العمل</span>
              <span class="value">{{ salaryData.worked_minutes / 60 | number:'1.0-2' }} ساعة</span>
            </div>
            <div class="detail-item">
              <span class="label">الوقت المتوقع</span>
              <span class="value">{{ salaryData.expected_minutes / 60 | number:'1.0-2' }} ساعة</span>
            </div>
            <div class="detail-item">
              <span class="label">الوقت الإضافي</span>
              <span class="value">{{ formatMinutes(salaryData.extra_minutes) }}</span>
            </div>
            <div class="detail-item">
              <span class="label">الوقت الناقص</span>
              <span class="value">{{ formatMinutes(salaryData.missing_minutes) }}</span>
            </div>
          </div>

          <div class="details-group">
            <h4>حساب الراتب</h4>
            <div class="detail-item">
              <span class="label">الراتب اليومي</span>
              <span class="value">{{ salaryData.daily_salary | number:'1.2-2' }} ج.م</span>
            </div>
            <div class="detail-item">
              <span class="label">الراتب بالساعة</span>
              <span class="value">{{ salaryData.hourly_salary | number:'1.2-2' }} ج.م</span>
            </div>
            <div class="detail-item highlight">
              <span class="label">إجمالي الإضافات</span>
              <span class="value">{{ salaryData.additions | number:'1.2-2' }} ج.م</span>
            </div>
            <div class="detail-item highlight">
              <span class="label">إجمالي الخصومات</span>
              <span class="value">{{ salaryData.deductions | number:'1.2-2' }} ج.م</span>
            </div>
          </div>
        </div>
      </div>

      <div class="salary-total">
        <div class="total-amount">
          <span class="label">صافي الراتب المستحق</span>
          <span class="value">{{ salaryData.final_salary | number:'1.2-2' }} ج.م</span>
        </div>
      </div>
    </div>
  </div>
</div>
